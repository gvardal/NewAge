SELECT 'YEDEK' AS 'Y', A.STOK_KODU AS Y_STOK_kODU, a.DEPO_KODU AS Y_DEPO_KODU, CONVERT(FLOAT,SAYIM) AS SAYIM, 'CANLI' AS 'C' ,B.STOK_KODU AS C_STOK_KODU, B.DEPO_KODU AS C_DEPO_KODU, CONVERT(FLOAT,BAKIYE) AS BAKIYE FROM (
SELECT STOK_KODU, DEPO_KODU,  IIF(SUM(CASE WHEN STHAR_GCKOD='G' THEN STHAR_GCMIK ELSE -STHAR_GCMIK END)<0,-SUM(CASE WHEN STHAR_GCKOD='G' THEN STHAR_GCMIK ELSE -STHAR_GCMIK END),SUM(CASE WHEN STHAR_GCKOD='G' THEN STHAR_GCMIK ELSE -STHAR_GCMIK END)) AS SAYIM,
IIF(SUM(CASE WHEN STHAR_GCKOD='G' THEN STHAR_GCMIK ELSE -STHAR_GCMIK END)>0,'G','C') AS STHAR_GCKOD   
FROM TBLSTHAR WITH(NOLOCK)  WHERE   STHAR_TARIH<'2023-03-07'
GROUP BY  STOK_KODU, DEPO_KODU) A
FULL JOIN ___STOKBAKIYE06032023_4 B ON A.STOK_KODU=B.STOK_kODU AND A.DEPO_KODU=B.DEPO_KODU
WHERE A.SAYIM<>B.BAKIYE AND A.STOK_KODU NOT LIKE '7%' 
ORDER BY 2 ASC